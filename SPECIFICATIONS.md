# アプリケーション仕様書: 意味的類似性判定ツール

## 1. はじめに

### 1.1. 本書の目的

本文書は、「意味的類似性判定ツール」の技術的な仕様を定義するものです。開発、テスト、および将来のメンテナンスの際の参照資料として使用されることを目的とします。

### 1.2. アプリケーション概要

本アプリケーションは、2つのテキストリスト、またはCSVファイルの2つのカラムに含まれる項目のペアワイズ比較を行い、意味的な類似性に関するアノテーション（判定）を効率的に行うためのWebツールです。ユーザーは柔軟に判定ラベルを設定でき、作業結果はCSVファイルとしてエクスポートできます。

## 2. システムアーキテクチャ

本システムは、フロントエンドとバックエンドが分離されたモダンなWebアプリケーション構成を採用し、Dockerによるコンテナ環境で動作します。

- **フロントエンド:**
    - **フレームワーク:** React (TypeScript)
    - **UIライブラリ:** Bootstrap
    - **責務:** ユーザーインターフェースの描画、ユーザー入力の受付、バックエンドAPIとの通信

- **バックエンド:**
    - **フレームワーク:** FastAPI (Python)
    - **主要ライブラリ:** Pandas (CSV処理)
    - **責務:** ビジネスロジックの処理、データ（ペア、判定結果）の管理、APIの提供

- **コンテナ技術:**
    - **オーケストレーション:** Docker Compose
    - **責務:** フロントエンドとバックエンドのサービスを独立したコンテナとして定義し、ビルド、実行、およびサービス間の連携を管理します。

## 3. 機能要件

### 3.1. データ入力

- **テキスト入力:**
    - ユーザーは、2つの独立したテキストエリアに、改行区切りで比較対象のテキストを入力できる。
- **CSVファイルアップロード:**
    - ユーザーは、ローカルからCSVファイルをアップロードできる。
    - アップロード後、アプリケーションはCSVファイルのヘッダーを自動的に抽出し、ドロップダウンリストに表示する。
    - ユーザーは、表示されたヘッダーから比較対象としたい2つのカラムを選択できる。

### 3.2. アノテーション（判定）

- **ラベル設定:**
    - ユーザーは、アノテーションに使用するラベルをカンマ区切りの文字列として自由に定義できる。（デフォルト: `True,False`）
    - アノテーション作業中に、必要に応じて新しいラベルを動的に追加できる。
- **ペアワイズ比較:**
    - データ入力後、「比較開始」ボタンを押下すると、アノテーション画面に遷移する。
    - 画面には、一度に1組のペアが表示される。
- **判定操作:**
    - ユーザーは、定義されたラベルのボタンをクリックすることで、表示されているペアの判定を行う。
    - 判定後、自動的に次のペアが表示される。
- **ナビゲーション:**
    - 「前へ」「次へ」ボタンにより、ペア間を自由に移動できる。
- **進捗確認:**
    - アノテーション全体の進捗状況を示すプログレスバーが表示される。

### 3.3. 結果

- **リアルタイム表示:**
    - アノテーション画面の下部に、すべてのペアとそれに対応する判定結果がテーブル形式でリアルタイムに表示される。
    - 現在判定中のペアは、テーブル内でハイライト表示される。
- **結果のダウンロード:**
    - 「結果をダウンロード」ボタンを押下すると、すべてのアノテーション結果（ペアと判定ラベル）が`annotation_results.csv`というファイル名でCSV形式でダウンロードされる。

### 3.4. 状態管理

- **リセット:**
    - 「リセット」ボタンを押下すると、入力データ、判定結果、ラベル設定など、アプリケーションのすべての状態が初期化され、最初の入力画面に戻る。

## 4. 非機能要件

- **ユーザビリティ:**
    - 直感的でわかりやすいUIを提供し、ユーザーが迷うことなく操作できること。
- **スケーラビリティ:**
    - 数千件程度のペアを処理する場合でも、パフォーマンスの著しい低下がなく、スムーズに動作すること。
- **メンテナンス性:**
    - コードは適切にコンポーネント化・モジュール化され、将来的な機能追加や修正が容易であること。

## 5. API仕様

バックエンドは以下のRESTful APIを提供します。

- `POST /api/lists`
    - **説明:** テキスト入力からリストを設定します。
    - **リクエストボディ:** `{"list1": "...", "list2": "..."}`
    - **レスポンス:** 成功メッセージ

- `POST /api/upload_csv`
    - **説明:** CSVファイルをアップロードし、選択されたカラムからリストを設定します。
    - **リクエストボディ:** `multipart/form-data` (file, column1, column2)
    - **レスポンス:** 成功メッセージ

- `GET /api/pairs`
    - **説明:** 現在のペアのリストを取得します。
    - **レスポンス:** `{"pairs": [["item1a", "item1b"], ...]}`

- `POST /api/judgment`
    - **説明:** 特定のペアに対する判定を記録します。
    - **リクエストボディ:** `{"index": 0, "judgment": "True"}`
    - **レスポンス:** 成功メッセージ

- `GET /api/results`
    - **説明:** 現在の判定結果を取得します。
    - **レスポンス:** `{"results": ["True", "False", ...], "pairs": [...]}`

- `GET /api/results/download`
    - **説明:** 判定結果をCSVファイルとしてダウンロードします。
    - **レスポンス:** CSVファイル

- `DELETE /api/reset`
    - **説明:** アプリケーションの状態をリセットします。
    - **レスポンス:** 成功メッセージ

## 6. UI/UXデザイン

- **メイン画面（入力画面）:**
    - アプリケーションのタイトルと簡単な説明を表示。
    - アノテーションラベルを設定する入力フィールドを配置。
    - 「テキスト入力」と「CSVアップロード」を切り替えるタブを配置。
    - 選択された入力方法に応じたUI（テキストエリアまたはファイルアップロード）を表示。
    - 「比較開始」ボタンを配置。

- **比較画面（アノテーション画面）:**
    - 上部に進捗バーを配置。
    - 中央に比較対象のペアをカード形式で左右に並べて表示。
    - ペアの下に、判定用のラベルボタンを動的に配置。
    - 新しいラベルを追加するための入力フォームを配置。
    - 「前へ」「次へ」のナビゲーションボタンを配置。
    - 下部に、判定結果一覧をテーブル形式で表示。
    - 最下部に、「リセット」および「結果をダウンロード」ボタンを配置。
